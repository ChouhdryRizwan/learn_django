# Django Models

A Django model is a table in your database.

Up until now in this tutorial, output has been static data from Python or HTML templates.

Now we will see how Django allows us to work with data, without having to change or upload files in the prosess.

In Django, data is created in objects, called Models, and is actually tables in a database.

## Create Table (Model)

To create a model, navigate to the `models.py` file in the `/projects/` folder and paste this code.

        from django.db import models

        class ProjectCategory(models.Model):
        name = models.CharField(max_length=50)
        
        def __str__(self):
                return self.name

        class Project(models.Model):
        title = models.CharField(max_length=100)
        description = models.TextField()
        project_url = models.URLField(blank=True)
        date_created = models.DateTimeField(auto_now_add=True)
        category = models.ForeignKey('ProjectCategory', on_delete=models.SET_NULL, null=True, blank=True)

        def __str__(self):
                return self.title    

        class ProjectImage(models.Model):
        image = models.ImageField(upload_to='project_images/')
        project = models.ForeignKey(Project, related_name='images', on_delete=models.CASCADE)
        
        def __str__(self):
                return f"Image for {self.project.title}"

## SQLite Database

When we created the Django project, we got an empty SQLite database.

It was created in the my_portfolio_app root folder, and has the filename db.sqlite3.

By default, all Models created in the Django project will be created as tables in this database.

# Migrate

Now when we have described a Model in the `models.py` file, we must run a command to actually create the table in the database.

Navigate to the /my_portfolio_app/ folder and run this command:

        py manage.py makemigrations projects

Which will result in this output:

        Migrations for 'projects':
        projects\migrations\0001_initial.py
        - Create model ProjectCategory
        - Create model Project
        - Create model ProjectImage

Django creates a file describing the changes and stores the file in the /migrations/ folder:

# Generated by Django 5.0.4 on 2024-04-23 16:11

import django.db.models.deletion
from django.db import migrations, models


        class Migration(migrations.Migration):

        initial = True

        dependencies = [
        ]

        operations = [
                migrations.CreateModel(
                name='ProjectCategory',
                fields=[
                        ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                        ('name', models.CharField(max_length=50)),
                ],
                ),
                migrations.CreateModel(
                name='Project',
                fields=[
                        ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                        ('title', models.CharField(max_length=100)),
                        ('description', models.TextField()),
                        ('project_url', models.URLField(blank=True)),
                        ('date_created', models.DateTimeField(auto_now_add=True)),
                        ('category', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='projects.projectcategory')),
                ],
                ),
                migrations.CreateModel(
                name='ProjectImage',
                fields=[
                        ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                        ('image', models.ImageField(upload_to='project_images/')),
                        ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='images', to='projects.project')),
                ],
                ),
        ]

       
Note that Django inserts an id field for your tables, which is an auto increment number (first record gets the value 1, the second record 2 etc.), this is the default behavior of Django, you can override it by describing your own id field.

The table is not created yet, you will have to run one more command, then Django will create and execute an SQL statement, based on the content of the new file in the /migrations/ folder.

Run the migrate command:

        py manage.py migrate

Which will result in this output:

        Operations to perform:
        Apply all migrations: admin, auth, contenttypes, projects, sessions
        Running migrations:
        Applying contenttypes.0001_initial... OK
        Applying auth.0001_initial... OK
        Applying admin.0001_initial... OK
        Applying admin.0002_logentry_remove_auto_add... OK
        Applying admin.0003_logentry_add_action_flag_choices... OK
        Applying contenttypes.0002_remove_content_type_name... OK
        Applying auth.0002_alter_permission_name_max_length... OK
        Applying auth.0003_alter_user_email_max_length... OK
        Applying auth.0004_alter_user_username_opts... OK
        Applying auth.0005_alter_user_last_login_null... OK
        Applying auth.0006_require_contenttypes_0002... OK
        Applying auth.0007_alter_validators_add_error_messages... OK
        Applying auth.0008_alter_user_username_max_length... OK
        Applying auth.0009_alter_user_last_name_max_length... OK
        Applying auth.0010_alter_group_name_max_length... OK
        Applying auth.0011_update_proxy_permissions... OK
        Applying auth.0012_alter_user_first_name_max_length... OK
        Applying projects.0001_initial... OK
        Applying sessions.0001_initial... OK

`Now you have a Project table in you database!`    

# View SQL

As a side-note: you can view the SQL statement that were executed from the migration above. All you have to do is to run this command, with the migration number:

        py manage.py sqlmigrate projects 0001

Which will result in this output:

        BEGIN;
        --
        -- Create model ProjectCategory
        --
        CREATE TABLE "projects_projectcategory" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" varchar(50) NOT NULL);
        --
        -- Create model Project
        --
        CREATE TABLE "projects_project" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "title" varchar(100) NOT NULL, "description" text NOT NULL, "project_url" varchar(200) NOT NULL, "date_created" datetime NOT NULL, "category_id" bigint NULL REFERENCES "projects_projectcategory" ("id") DEFERRABLE INITIALLY DEFERRED);
        --
        -- Create model ProjectImage
        --
        CREATE TABLE "projects_projectimage" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "image" varchar(100) NOT NULL, "project_id" bigint NOT NULL REFERENCES "projects_project" ("id") DEFERRABLE INITIALLY DEFERRED);
        CREATE INDEX "projects_project_category_id_708edb98" ON "projects_project" ("category_id");
        CREATE INDEX "projects_projectimage_project_id_618ded0e" ON "projects_projectimage" ("project_id");
        COMMIT;

`Now we have to register this models in admin to create, read, update and delete the records.`